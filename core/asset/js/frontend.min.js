/**
 * Initialise l'objet principale de WPshop.
 *
 * @since 2.0.0
 */
window.eoxiaJS.wpshop = {};
window.eoxiaJS.wpshopFrontend = {};

/**
 * Gestion JS du tunnel de vente.
 *
 * @since 2.0.0
 */
window.eoxiaJS.wpshopFrontend.cart = {};

/**
 * La méthode "init" est appelé automatiquement par la lib JS de Eo-Framework
 *
 * @since 2.0.0
 */
window.eoxiaJS.wpshopFrontend.cart.init = function() {
	window.eoxiaJS.wpshopFrontend.cart.event();
};

window.eoxiaJS.wpshopFrontend.cart.event = function() {
	jQuery( document ).on( 'change', '.cart .cart-qty', window.eoxiaJS.wpshopFrontend.cart.enabledButtonUpdateCart );
}

window.eoxiaJS.wpshopFrontend.cart.enabledButtonUpdateCart = function() {
	jQuery( '.cart .update-cart' ).removeClass( 'button-disable' );
}

window.eoxiaJS.wpshopFrontend.cart.addedToCart = function ( triggeredElement, response ) {
	if ( ! triggeredElement.next().hasClass('view-cart') ) {
		triggeredElement.after( response.data.view );
	}

	var qty = jQuery( '.cart-button .qty-value' ).text();

	if ( ! qty ) {
		qty = 1;
	} else {
		qty++;
	}

	jQuery( '.cart-button .qty' ).html( '(<span class="qty-value">' + qty + '</span>)' );
};

window.eoxiaJS.wpshopFrontend.cart.updatedCart = function ( triggeredElement, response ) {
	jQuery( '.cart' ).replaceWith( response.data.view );
};

window.eoxiaJS.wpshopFrontend.cart.deletedProdutFromCart = function ( triggeredElement, response ) {
	jQuery( '.cart' ).replaceWith( response.data.view );
};

/**
 * Gestion JS du tunnel de vente.
 *
 * @since 2.0.0
 */
window.eoxiaJS.wpshopFrontend.myAccount = {};

/**
 * La méthode "init" est appelé automatiquement par la lib JS de Eo-Framework
 *
 * @since 2.0.0
 */
window.eoxiaJS.wpshopFrontend.myAccount.init = function() {};

window.eoxiaJS.wpshopFrontend.myAccount.reorderSuccess = function( triggeredElement, response ) {
	document.location.href = response.data.redirect_url;
};

/**
 * Gestion JS du tunnel de vente.
 *
 * @since 2.0.0
 */
window.eoxiaJS.wpshopFrontend.stripe = {};

/**
 * La méthode "init" est appelé automatiquement par la lib JS de Eo-Framework
 *
 * @since 2.0.0
 */
window.eoxiaJS.wpshopFrontend.stripe.init = function() {};

window.eoxiaJS.wpshopFrontend.stripe.redirectToPayment = function(triggeredElement, response) {
	var stripe = Stripe(
	  'pk_live_pYts1WDeu2Mn4NHzVnMC3peF',
	  {
	    betas: ['checkout_beta_4'],
	  }
	);

	stripe.redirectToCheckout({
 		sessionId: response.data.id
	}).then(function (result) {
	  console.log(result);
	});
}

/**
 * Gestion JS du tunnel de vente.
 *
 * @since 2.0.0
 */
window.eoxiaJS.wpshopFrontend.checkout = {};

/**
 * La méthode "init" est appelé automatiquement par la lib JS de Eo-Framework
 *
 * @since 2.0.0
 */
window.eoxiaJS.wpshopFrontend.checkout.init = function() {
	window.eoxiaJS.wpshopFrontend.checkout.event();
};

window.eoxiaJS.wpshopFrontend.checkout.event = function() {
	jQuery( '.checkout-login .wpeo-button' ).click( function() {
		jQuery( '.checkout-login .content-login' ).slideToggle();
	} );
};

window.eoxiaJS.wpshopFrontend.checkout.loadedEditBillingAddress = function( triggeredElement, response ) {
	jQuery( '.shipping-address' ).html( response.data.view );
};

window.eoxiaJS.wpshopFrontend.checkout.checkoutErrors = function( triggeredElement, response ) {
	if ( 0 === jQuery( 'form.wps-checkout-step-1 ul.error.notice' ).length ) {
		jQuery( 'form.wps-checkout-step-1' ).prepend( response.data.template );
	} else {
		jQuery( 'form.wps-checkout-step-1 ul.error.notice' ).replaceWith( response.data.template );
	}

	for ( var key in response.data.errors.error_data ) {
		jQuery( 'form.wps-checkout-step-1 .' + response.data.errors.error_data[ key ].input_class ).addClass( 'form-element-error' );
	}
};

window.eoxiaJS.wpshopFrontend.checkout.createdThirdSuccess = function( triggeredElement, response ) {
	document.location.href = response.data.redirect_url;
}

window.eoxiaJS.wpshopFrontend.checkout.redirectToPayment = function( triggeredElement, response ) {
	document.location.href = response.data.url;
};

window.eoxiaJS.wpshopFrontend.checkout.redirect = function( triggeredElement, response ) {
	document.location.href = response.data.url;
};
